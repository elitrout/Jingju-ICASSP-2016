<!DOCTYPE html>
<html lang="en">
    <style>
        body { font: 12px Arial;}
        
        path { 
            stroke: PaleVioletRed;
            stroke-width: 2;
            fill: none;
        }
        
        .axis path,
        .axis line {
            fill: none;
            stroke: grey;
            stroke-width: 1;
            shape-rendering: crispEdges;
        }

    </style>

    <div id="area1" style="width:80%; margin:0 auto;"></div>
    <div id="area2" style="width:80%; margin:0 auto;"></div>

    <head>
        <meta charset="utf-8">
        <title>D3 Test</title>
        <script type="text/javascript" src="d3/d3.js"></script>
    </head>

    <body>
        <script type="text/javascript">
            // Set the dimensions of the canvas / graph
            var margin = {top: 30, right: 20, bottom: 40, left: 50},
                width = 800 - margin.left - margin.right,
                height = 300 - margin.top - margin.bottom;

            // Set the ranges
            var x = d3.scale.linear().range([0, width]);
            var y = d3.scale.linear().range([height, 0]);
            
            // Define the axes
            var xAxis = d3.svg.axis().scale(x)
                .orient("bottom").ticks(10);
            
            var yAxis = d3.svg.axis().scale(y)
                .orient("left").ticks(10);

        // Teacher plot
            
            // Adds the svg canvas
            var svg1 = d3.select("#area1")
                .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                .append("g")
                    .attr("transform", 
                          "translate(" + margin.left + "," + margin.top + ")");

            // Plot X axis label
            svg1.append("text")
               .attr("transform", "translate(" + (width / 2) + " ," + (height + margin.bottom) + ")")
               .style("text-anchor", "middle")
               .text("Time");

            // Plot Y axis label
            svg1.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x",0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text("Pitch (MIDI)");

            // Define the line
            var pitchtrack1 = d3.svg.line()
                .defined(function(d) { return !isNaN(d.pitch); })    // Don't plot silence (pitch value set to NaN)
                .x(function(d) { return x(d.time); })
                .y(function(d) { return y(d.pitch); });

            // Plot pitch track
            d3.tsv("data/pitchtracknotetranscriptionsegmentation/weiguojia_section_pro_regression_pitchtrack.txt", function(error, data) {
                data.forEach(function(d) {
                    d.time = +d.time;
                    d.pitch = +d.pitch;
                });
            
                // Scale the range of the data
                x.domain([0, d3.max(data, function(d) { return d.time; })]).nice();
                y.domain([d3.min(data, function(d) { return d.pitch; }), 2 + d3.max(data, function(d) { return d.pitch; })]).nice();

                // Add the pitchtrack path.
                svg1.append("path")
                    .attr("class", "line")
                    .attr("d", pitchtrack1(data));
            
                // Add the X Axis
                svg1.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + height + ")")
                    .call(xAxis);
            
                // Add the Y Axis
                svg1.append("g")
                    .attr("class", "y axis")
                    .call(yAxis);
            
            });

            // Plot MIDI notes
            var MIDInote_t;

            d3.tsv("data/pitchtracknotetranscriptionsegmentation/weiguojia_section_pro_monoNoteOut_midi.txt", function(error, data) {
                data.forEach(function(d) {
                    d.startTime = +d.startTime;
                    d.pitch = +d.pitch;
	    	    d.duration = +d.duration;
                });
		
		MIDInote_t = data;
		
	    	var MIDInotes = svg1.selectAll("rect")
                                   .data(data)
                                   .enter()
                                   .append("rect");

		var MIDInoteOffset = 4;    // The vertical center of the note rect is aligned to the pitch
	    	MIDInotes.attr("x", function(d) {return x(d.startTime);})
	    	         .attr("y", function(d) {return y(d.pitch) - MIDInoteOffset;})
	    	         .attr("width", function(d) {return x(d.duration);})
	    	         .attr("height", 8)
		         .attr("fill", "DarkCyan")
		         .attr("opacity", 0.7)
		         .attr("id", function(d, i){var noteid = 't'+i; return noteid; })    // Note ID for alignment visualization
		         .on("mouseover", function(d, i) {
			                      d3.select("#t"+i).attr("fill", "Purple");
			                      d3.select("#s"+i).attr("fill", "Purple");

			                      // Draw note boundary
			                      var note_t = d.pitch
			                      var note_s = MIDInote_s[i].pitch;
			                      var noteStart_t = Number(d3.select(this).attr("x"));
			                      var noteStartTime_t = MIDInote_t[i].startTime;
			                      var noteDuration_t = Number(d3.select(this).attr("width"));
			                      var noteDurationTime_t = MIDInote_t[i].duration;
					      var noteEnd_t = noteStart_t + noteDuration_t;
					      var noteEndTime_t = noteStartTime_t + noteDurationTime_t;
			                      var noteStart_s = Number(d3.select("#s"+i).attr("x"));
			                      var noteStartTime_s = MIDInote_s[i].startTime;
			                      var noteDuration_s = Number(d3.select("#s"+i).attr("width"));
			                      var noteDurationTime_s = MIDInote_s[i].duration;
					      var noteEnd_s = noteStart_s + noteDuration_s;
					      var noteEndTime_s = noteStartTime_s + noteDurationTime_s;
			                      svg1.append("line")
				                  // .attr("x1", x(d.startTime))
				                  .attr("x1", noteStart_t)
				                  .attr("y1", height)
				                  .attr("x2", noteStart_t)
				                  .attr("y2", 0)
				                  .style("stroke", "grey")
				                  .style("stroke-dasharray", "3");
			                      svg1.append("line")
				                  .attr("x1", noteEnd_t) 
				                  .attr("y1", height)
				                  .attr("x2", noteEnd_t)
				                  .attr("y2", 0)
				                  .style("stroke", "grey")
				                  .style("stroke-dasharray", "3");
			                      svg2.append("line")
				                  .attr("x1", noteStart_s)
				                  .attr("y1", height)
				                  .attr("x2", noteStart_s)
				                  .attr("y2", 0)
				                  .style("stroke", "grey")
				                  .style("stroke-dasharray", "3");
			                      svg2.append("line")
				                  .attr("x1", noteEnd_s) 
				                  .attr("y1", height)
				                  .attr("x2", noteEnd_s)
				                  .attr("y2", 0)
				                  .style("stroke", "grey")
				                  .style("stroke-dasharray", "3");

			                      // Print note information
			                      svg1.append("text")
			                          .attr("id", "info_note")
				                  .attr("transform", "translate(" + width + " ," + 10 + ")")
			                          .attr("fill", "grey")
				                  .style("text-anchor", "end")
				                  .text("Note: " + note_t);
			                      svg1.append("text")
			                          .attr("id", "info_freq")
				                  .attr("transform", "translate(" + width + " ," + 25 + ")")
			                          .attr("fill", "grey")
				                  .style("text-anchor", "end")
				                  .text("Freq: " + note_t);
			                      svg1.append("text")
			                          .attr("id", "info_time")
				                  .attr("transform", "translate(" + width + " ," + 40 + ")")
			                          .attr("fill", "grey")
				                  .style("text-anchor", "end")
				                  .text("Time: " + noteStartTime_t.toFixed(2) + ' - ' + (Number(noteStartTime_t.toFixed(2)) + Number(noteDurationTime_t.toFixed(2))).toFixed(2) + 's (' + noteDurationTime_t.toFixed(2) + 's)');
			                      svg2.append("text")
			                          .attr("id", "info_note")
				                  .attr("transform", "translate(" + width + " ," + 10 + ")")
			                          .attr("fill", "grey")
				                  .style("text-anchor", "end")
				                  .text("Note: " + note_s);
			                      svg2.append("text")
			                          .attr("id", "info_freq")
				                  .attr("transform", "translate(" + width + " ," + 25 + ")")
			                          .attr("fill", "grey")
				                  .style("text-anchor", "end")
				                  .text("Freq: " + note_s);
			                      svg2.append("text")
			                          .attr("id", "info_time")
				                  .attr("transform", "translate(" + width + " ," + 40 + ")")
			                          .attr("fill", "grey")
				                  .style("text-anchor", "end")
				                  .text("Time: " + noteStartTime_s.toFixed(2) + ' - ' + (Number(noteStartTime_s.toFixed(2)) + Number(noteDurationTime_s.toFixed(2))).toFixed(2) + 's (' + noteDurationTime_s.toFixed(2) + 's)');
			                  })
		         .on("mouseout", function(d, i) {
			                     d3.select("#t"+i).attr("fill", "DarkCyan");
			                     d3.select("#s"+i).attr("fill", "DarkCyan");
			                     svg1.selectAll('line').remove();
			                     svg2.selectAll('line').remove();
			                     svg1.select("#info_note").remove();
			                     svg1.select("#info_freq").remove();
			                     svg1.select("#info_time").remove();
			                     svg2.select("#info_note").remove();
			                     svg2.select("#info_freq").remove();
			                     svg2.select("#info_time").remove();
			                 });
            });


        // Student plot
            
            // Adds the svg canvas
            var svg2 = d3.select("#area2")
                .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                .append("g")
                    .attr("transform", 
                          "translate(" + margin.left + "," + margin.top + ")");

            // Label of X axis
            svg2.append("text")
               .attr("transform", "translate(" + (width / 2) + " ," + (height + margin.bottom) + ")")
               .style("text-anchor", "middle")
               .text("Time");

            // Label of Y axis
            svg2.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x",0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text("Pitch (MIDI)");

            // Define the line
            var pitchtrack2 = d3.svg.line()
                .defined(function(d) { return !isNaN(d.pitch); })    // Don't plot silence (pitch value set to NaN)
                .x(function(d) { return x(d.time); })
                .y(function(d) { return y(d.pitch); });

            // Plot pitch track
            d3.tsv("data/pitchtracknotetranscriptionsegmentation/weiguojia_section_pro_regression_pitchtrack.txt", function(error, data) {
                data.forEach(function(d) {
                    d.time = +d.time;
                    d.pitch = +d.pitch;
                });
            
                // Scale the range of the data
                x.domain([0, d3.max(data, function(d) { return d.time; })]).nice();
                y.domain([d3.min(data, function(d) { return d.pitch; }), 2 + d3.max(data, function(d) { return d.pitch; })]).nice();

                // Add the pitchtrack path.
                svg2.append("path")
                    .attr("class", "line")
                    .attr("d", pitchtrack2(data))
		    .style("pointer-events", "none");    // Prevent mouseover failing on overlapping part
            
                // Add the X Axis
                svg2.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + height + ")")
                    .call(xAxis);
            
                // Add the Y Axis
                svg2.append("g")
                    .attr("class", "y axis")
                    .call(yAxis);
            
            });

            // Plot MIDI notes
            var MIDInote_s;

            d3.tsv("data/pitchtracknotetranscriptionsegmentation/weiguojia_section_pro_monoNoteOut_midi.txt", function(error, data) {
                data.forEach(function(d) {
                    d.startTime = +d.startTime;
                    d.pitch = +d.pitch;
	    	    d.duration = +d.duration;
                });

		MIDInote_s = data;

	    	var MIDInotes = svg2.selectAll("rect")
                                   .data(data)
                                   .enter()
                                   .append("rect");

	    	MIDInotes.attr("x", function(d) {return x(d.startTime);})
	    	         .attr("y", function(d) {return y(d.pitch) - 4;})
	    	         .attr("width", function(d) {return x(d.duration);})
	    	         .attr("height", 8)
		         .attr("fill", "DarkCyan")
		         .attr("opacity", 0.7)
		         .attr("id", function(d, i){var noteid = 's'+i; return noteid; })    // Note ID for alignment visualization
		         .on("mouseover", function(d, i) {
			                      d3.select("#s"+i).attr("fill", "Purple");
			                      d3.select("#t"+i).attr("fill", "Purple");

			                      // Draw note boundary
			                      var note_t = MIDInote_t[i].pitch;
			                      var note_s = d.pitch;
			                      var noteStart_s = Number(d3.select(this).attr("x"));
			                      var noteStartTime_s = MIDInote_s[i].startTime;
			                      var noteDuration_s = Number(d3.select(this).attr("width"));
			                      var noteDurationTime_s = MIDInote_s[i].duration;
					      var noteEnd_s = noteStart_s + noteDuration_s;
					      var noteEndTime_s = noteStartTime_s + noteDurationTime_s;
			                      var noteStart_t = Number(d3.select("#t"+i).attr("x"));
			                      var noteStartTime_t = MIDInote_t[i].startTime;
			                      var noteDuration_t = Number(d3.select("#t"+i).attr("width"));
			                      var noteDurationTime_t = MIDInote_t[i].duration;
					      var noteEnd_t = noteStart_t + noteDuration_t;
					      var noteEndTime_t = noteStartTime_t + noteDurationTime_t;
			                      svg1.append("line")
				                  // .attr("x1", x(d.startTime))
				                  .attr("x1", noteStart_t)
				                  .attr("y1", height)
				                  .attr("x2", noteStart_t)
				                  .attr("y2", 0)
				                  .style("stroke", "grey")
				                  .style("stroke-dasharray", "3");
			                      svg1.append("line")
				                  .attr("x1", noteEnd_t) 
				                  .attr("y1", height)
				                  .attr("x2", noteEnd_t)
				                  .attr("y2", 0)
				                  .style("stroke", "grey")
				                  .style("stroke-dasharray", "3");
			                      svg2.append("line")
				                  .attr("x1", noteStart_s)
				                  .attr("y1", height)
				                  .attr("x2", noteStart_s)
				                  .attr("y2", 0)
				                  .style("stroke", "grey")
				                  .style("stroke-dasharray", "3");
			                      svg2.append("line")
				                  .attr("x1", noteEnd_s) 
				                  .attr("y1", height)
				                  .attr("x2", noteEnd_s)
				                  .attr("y2", 0)
				                  .style("stroke", "grey")
				                  .style("stroke-dasharray", "3");


			                      // Print note information
			                      svg1.append("text")
			                          .attr("id", "info_note")
				                  .attr("transform", "translate(" + width + " ," + 10 + ")")
			                          .attr("fill", "grey")
				                  .style("text-anchor", "end")
				                  .text("Note: " + note_t);
			                      svg1.append("text")
			                          .attr("id", "info_freq")
				                  .attr("transform", "translate(" + width + " ," + 25 + ")")
			                          .attr("fill", "grey")
				                  .style("text-anchor", "end")
				                  .text("Freq: " + note_t);
			                      svg1.append("text")
			                          .attr("id", "info_time")
				                  .attr("transform", "translate(" + width + " ," + 40 + ")")
			                          .attr("fill", "grey")
				                  .style("text-anchor", "end")
				                  .text("Time: " + noteStartTime_t.toFixed(2) + ' - ' + (Number(noteStartTime_t.toFixed(2)) + Number(noteDurationTime_t.toFixed(2))).toFixed(2) + 's (' + noteDurationTime_t.toFixed(2) + 's)');
			                      svg2.append("text")
			                          .attr("id", "info_note")
				                  .attr("transform", "translate(" + width + " ," + 10 + ")")
			                          .attr("fill", "grey")
				                  .style("text-anchor", "end")
				                  .text("Note: " + note_s);
			                      svg2.append("text")
			                          .attr("id", "info_freq")
				                  .attr("transform", "translate(" + width + " ," + 25 + ")")
			                          .attr("fill", "grey")
				                  .style("text-anchor", "end")
				                  .text("Freq: " + note_s);
			                      svg2.append("text")
			                          .attr("id", "info_time")
				                  .attr("transform", "translate(" + width + " ," + 40 + ")")
			                          .attr("fill", "grey")
				                  .style("text-anchor", "end")
				                  .text("Time: " + noteStartTime_s.toFixed(2) + ' - ' + (Number(noteStartTime_s.toFixed(2)) + Number(noteDurationTime_s.toFixed(2))).toFixed(2) + 's (' + noteDurationTime_s.toFixed(2) + 's)');
			                  })
		         .on("mouseout", function(d, i) {
			                     d3.select("#s"+i).attr("fill", "DarkCyan");
			                     d3.select("#t"+i).attr("fill", "DarkCyan");
			                     svg1.selectAll('line').remove();
			                     svg2.selectAll('line').remove();
			                     svg1.select("#info_note").remove();
			                     svg1.select("#info_freq").remove();
			                     svg1.select("#info_time").remove();
			                     svg2.select("#info_note").remove();
			                     svg2.select("#info_freq").remove();
			                     svg2.select("#info_time").remove();
			                 });
            });

        </script>
    </body>
</html>     
