<!DOCTYPE html>
<html lang="en">
    <style>
        body { font: 12px Arial;}
        
        path { 
            stroke: PaleVioletRed;
            stroke-width: 2;
            fill: none;
        }
        
        .axis path,
        .axis line {
            fill: none;
            stroke: grey;
            stroke-width: 1;
            shape-rendering: crispEdges;
        }
    </style>

    <head>
        <meta charset="utf-8">
        <title>D3 Test</title>
        <script type="text/javascript" src="d3/d3.js"></script>
    </head>

    <body>
        <script type="text/javascript">
            // Set the dimensions of the canvas / graph
            var margin = {top: 30, right: 20, bottom: 30, left: 50},
                width = 600 - margin.left - margin.right,
                height = 270 - margin.top - margin.bottom;

            // Set the ranges
            var x = d3.scale.linear().range([0, width]);
            var y = d3.scale.linear().range([height, 0]);
            
            // Define the axes
            var xAxis = d3.svg.axis().scale(x)
                .orient("bottom").ticks(10);
            
            var yAxis = d3.svg.axis().scale(y)
                .orient("left").ticks(10);
            
            // Adds the svg canvas
            var svg = d3.select("body")
                .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                .append("g")
                    .attr("transform", 
                          "translate(" + margin.left + "," + margin.top + ")");

            svg.append("text")
               .attr("transform", "translate(" + (width / 2) + " ," + (height + margin.bottom) + ")")
               .style("text-anchor", "middle")
               .text("Time");

            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x",0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text("Pitch (MIDI)");

            // Define the line
            var pitchtrack = d3.svg.line()
                .defined(function(d) { return !isNaN(d.pitch); })    // Don't plot silence (pitch value set to NaN)
                .x(function(d) { return x(d.time); })
                .y(function(d) { return y(d.pitch); });

            // Plot pitch track
            d3.tsv("data/pitchtracknotetranscriptionsegmentation/weiguojia_section_pro_regression_pitchtrack.txt", function(error, data) {
                data.forEach(function(d) {
                    d.time = +d.time;
                    d.pitch = +d.pitch;
                });
            
                // Scale the range of the data
                x.domain([0, d3.max(data, function(d) { return d.time; })]).nice();
                y.domain([d3.min(data, function(d) { return d.pitch; }), d3.max(data, function(d) { return d.pitch; })]).nice();

                // Add the pitchtrack path.
                svg.append("path")
                    .attr("class", "line")
                    .attr("d", pitchtrack(data));
            
                // Add the X Axis
                svg.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + height + ")")
                    .call(xAxis);
            
                // Add the Y Axis
                svg.append("g")
                    .attr("class", "y axis")
                    .call(yAxis);
            
            });

            // Plot MIDI notes
            d3.tsv("data/pitchtracknotetranscriptionsegmentation/weiguojia_section_pro_monoNoteOut_midi.txt", function(error, data) {
                data.forEach(function(d) {
                    d.startTime = +d.startTime;
                    d.pitch = +d.pitch;
	    	    d.duration = +d.duration;
                });

                // var note = svg.selectAll("g")
                //               .data(data)
                //               .enter().append("g")
                //               .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });
		
	    	var MIDInotes = svg.selectAll("rect")
                                   .data(data)
                                   .enter()
                                   .append("rect");

	    	MIDInotes.attr("x", function(d) {return x(d.startTime);})
	    	         .attr("y", function(d) {return y(d.pitch) - 4;})
	    	         .attr("width", function(d) {return x(d.duration);})
	    	         .attr("height", 8)
		         .attr("fill", "DarkCyan")
		         .attr("opacity", 0.7)
		         .on("mouseover", function() {d3.select(this).attr("fill", "Purple");})
		         .on("mouseout", function() {d3.select(this).attr("fill", "DarkCyan");});

            });

        </script>
    </body>
</html>     
