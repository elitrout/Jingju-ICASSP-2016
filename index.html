<!DOCTYPE html>
<html lang="en">
    <style>
        body { font: 12px Arial;}
        
        path { 
            stroke: PaleVioletRed;
            stroke-width: 2;
            fill: none;
        }
        
        .axis path,
        .axis line {
            fill: none;
            stroke: grey;
            stroke-width: 1;
            shape-rendering: crispEdges;
        }

    </style>

    <div id="area1" style="width:80%; margin:0 auto;"></div>
    <div id="area2" style="width:80%; margin:0 auto;"></div>

    <head>
        <meta charset="utf-8">
        <title>D3 Test</title>
        <script type="text/javascript" src="d3/d3.js"></script>
    </head>

    <body>
        <script type="text/javascript">
            // Set the dimensions of the canvas / graph
            var margin = {top: 30, right: 20, bottom: 40, left: 50},
                width = 800 - margin.left - margin.right,
                height = 300 - margin.top - margin.bottom;

            // Set the ranges
            var x = d3.scale.linear().range([0, width]);
            var y = d3.scale.linear().range([height, 0]);
            
            // Define the axes
            var xAxis = d3.svg.axis().scale(x)
                .orient("bottom").ticks(10);
            
            var yAxis = d3.svg.axis().scale(y)
                .orient("left").ticks(10);

        // Pro plot
            
            // Adds the svg canvas
            var svg1 = d3.select("#area1")
                .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                .append("g")
                    .attr("transform", 
                          "translate(" + margin.left + "," + margin.top + ")");

            // Label of X axis
            svg1.append("text")
               .attr("transform", "translate(" + (width / 2) + " ," + (height + margin.bottom) + ")")
               .style("text-anchor", "middle")
               .text("Time");

            // Label of Y axis
            svg1.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x",0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text("Pitch (MIDI)");

            // Define the line
            var pitchtrack1 = d3.svg.line()
                .defined(function(d) { return !isNaN(d.pitch); })    // Don't plot silence (pitch value set to NaN)
                .x(function(d) { return x(d.time); })
                .y(function(d) { return y(d.pitch); });

            // Plot pitch track
            d3.tsv("data/pitchtracknotetranscriptionsegmentation/weiguojia_section_pro_regression_pitchtrack.txt", function(error, data) {
                data.forEach(function(d) {
                    d.time = +d.time;
                    d.pitch = +d.pitch;
                });
            
                // Scale the range of the data
                x.domain([0, d3.max(data, function(d) { return d.time; })]).nice();
                y.domain([d3.min(data, function(d) { return d.pitch; }), d3.max(data, function(d) { return d.pitch; })]).nice();

                // Add the pitchtrack path.
                svg1.append("path")
                    .attr("class", "line")
                    .attr("d", pitchtrack1(data));
            
                // Add the X Axis
                svg1.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + height + ")")
                    .call(xAxis);
            
                // Add the Y Axis
                svg1.append("g")
                    .attr("class", "y axis")
                    .call(yAxis);
            
            });

            // Plot MIDI notes
            d3.tsv("data/pitchtracknotetranscriptionsegmentation/weiguojia_section_pro_monoNoteOut_midi.txt", function(error, data) {
                data.forEach(function(d) {
                    d.startTime = +d.startTime;
                    d.pitch = +d.pitch;
	    	    d.duration = +d.duration;
                });
		
	    	var MIDInotes = svg1.selectAll("rect")
                                   .data(data)
                                   .enter()
                                   .append("rect");

	    	MIDInotes.attr("x", function(d) {return x(d.startTime);})
	    	         .attr("y", function(d) {return y(d.pitch) - 4;})
	    	         .attr("width", function(d) {return x(d.duration);})
	    	         .attr("height", 8)
		         .attr("fill", "DarkCyan")
		         .attr("opacity", 0.7)
		         .attr("id", function(d, i){var noteid = 'p'+i; return noteid; })    // Note ID for alignment visualization
		         .on("mouseover", function(d, i) {
			                      d3.select("#p"+i).attr("fill", "Purple");
			                      d3.select("#s"+i).attr("fill", "Purple");
			                      // Draw note boundary
			                      svg1.append("line")
				                  // .attr("x1", x(d.startTime))
				                  .attr("x1", Number(d3.select(this).attr("x")))
				                  .attr("y1", height)
				                  .attr("x2", Number(d3.select(this).attr("x")))
				                  .attr("y2", 0)
				                  .style("stroke", "grey")
				                  .style("stroke-dasharray", "3");
			                      svg1.append("line")
				                  .attr("x1", Number(d3.select(this).attr("x")) + Number(d3.select(this).attr("width"))) 
				                  .attr("y1", height)
				                  .attr("x2", Number(d3.select(this).attr("x")) + Number(d3.select(this).attr("width")))
				                  .attr("y2", 0)
				                  .style("stroke", "grey")
				                  .style("stroke-dasharray", "3");
			                      svg2.append("line")
				                  .attr("x1", Number(d3.select("#s"+i).attr("x")))
				                  .attr("y1", height)
				                  .attr("x2", Number(d3.select("#s"+i).attr("x")))
				                  .attr("y2", 0)
				                  .style("stroke", "grey")
				                  .style("stroke-dasharray", "3");
			                      svg2.append("line")
				                  .attr("x1", Number(d3.select("#s"+i).attr("x")) + Number(d3.select(this).attr("width"))) 
				                  .attr("y1", height)
				                  .attr("x2", Number(d3.select("#s"+i).attr("x")) + Number(d3.select(this).attr("width")))
				                  .attr("y2", 0)
				                  .style("stroke", "grey")
				                  .style("stroke-dasharray", "3");
			                  })
		         .on("mouseout", function(d, i) {
			                     d3.select("#p"+i).attr("fill", "DarkCyan");
			                     d3.select("#s"+i).attr("fill", "DarkCyan");
			                     svg1.selectAll('line').remove();
			                     svg2.selectAll('line').remove();
			                 });
            });


        // Student plot
            
            // Adds the svg canvas
            var svg2 = d3.select("#area2")
                .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                .append("g")
                    .attr("transform", 
                          "translate(" + margin.left + "," + margin.top + ")");

            // Label of X axis
            svg2.append("text")
               .attr("transform", "translate(" + (width / 2) + " ," + (height + margin.bottom) + ")")
               .style("text-anchor", "middle")
               .text("Time");

            // Label of Y axis
            svg2.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x",0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text("Pitch (MIDI)");

            // Define the line
            var pitchtrack2 = d3.svg.line()
                .defined(function(d) { return !isNaN(d.pitch); })    // Don't plot silence (pitch value set to NaN)
                .x(function(d) { return x(d.time); })
                .y(function(d) { return y(d.pitch); });

            // Plot pitch track
            d3.tsv("data/pitchtracknotetranscriptionsegmentation/weiguojia_section_pro_regression_pitchtrack.txt", function(error, data) {
                data.forEach(function(d) {
                    d.time = +d.time;
                    d.pitch = +d.pitch;
                });
            
                // Scale the range of the data
                x.domain([0, d3.max(data, function(d) { return d.time; })]).nice();
                y.domain([d3.min(data, function(d) { return d.pitch; }), d3.max(data, function(d) { return d.pitch; })]).nice();

                // Add the pitchtrack path.
                svg2.append("path")
                    .attr("class", "line")
                    .attr("d", pitchtrack2(data))
		    .style("pointer-events", "none");    // Prevent mouseover failing on overlapping part
            
                // Add the X Axis
                svg2.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + height + ")")
                    .call(xAxis);
            
                // Add the Y Axis
                svg2.append("g")
                    .attr("class", "y axis")
                    .call(yAxis);
            
            });

            // Plot MIDI notes
            d3.tsv("data/pitchtracknotetranscriptionsegmentation/weiguojia_section_pro_monoNoteOut_midi.txt", function(error, data) {
                data.forEach(function(d) {
                    d.startTime = +d.startTime;
                    d.pitch = +d.pitch;
	    	    d.duration = +d.duration;
                });

	    	var MIDInotes = svg2.selectAll("rect")
                                   .data(data)
                                   .enter()
                                   .append("rect");

	    	MIDInotes.attr("x", function(d) {return x(d.startTime);})
	    	         .attr("y", function(d) {return y(d.pitch) - 4;})
	    	         .attr("width", function(d) {return x(d.duration);})
	    	         .attr("height", 8)
		         .attr("fill", "DarkCyan")
		         .attr("opacity", 0.7)
		         .attr("id", function(d, i){var noteid = 's'+i; return noteid; })    // Note ID for alignment visualization
		         .on("mouseover", function(d, i) {d3.select("#s"+i).attr("fill", "Purple");
							  d3.select("#p"+i).attr("fill", "Purple");})
		         .on("mouseout", function(d, i) {d3.select("#s"+i).attr("fill", "DarkCyan");
							 d3.select("#p"+i).attr("fill", "DarkCyan");});
            });

        </script>
    </body>
</html>     
